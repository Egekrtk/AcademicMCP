
<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Academic Chat MCP</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f4f7f6;
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        header {
            background: #2c3e50;
            color: white;
            padding: 1rem;
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
        }

        #chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .message {
            max-width: 80%;
            padding: 1rem;
            border-radius: 15px;
            line-height: 1.5;
            white-space: pre-wrap;
        }

        .user {
            align-self: flex-end;
            background: #3498db;
            color: white;
        }

        .bot {
            align-self: flex-start;
            background: white;
            border: 1px solid #ddd;
            color: #333;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .sources {
            font-size: 0.8rem;
            margin-top: 10px;
            border-top: 1px solid #eee;
            padding-top: 5px;
            color: #666;
        }

        #input-area {
            background: white;
            padding: 1.5rem;
            display: flex;
            gap: 10px;
            border-top: 1px solid #ddd;
        }

        input {
            flex: 1;
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1rem;
        }

        button {
            padding: 12px 25px;
            background: #27ae60;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: 0.3s;
        }

            button:hover {
                background: #219150;
            }

        .loading {
            font-style: italic;
            color: #888;
        }
    </style>
</head>
<body>
    <header>Academic Research Assistant</header>
    <div id="chat-container">
        <div class="message bot">Merhaba! Hangi akademik konuda derinlemesine bir araştırma yapmamı istersin? Tüm makaleleri senin için tarayacağım.</div>
    </div>
    <div id="input-area">
        <input type="text" id="queryInput" placeholder="Sorgunuzu buraya yazın... (Örn: Quantum Computing)">
        <button onclick="sendQuery()">Araştır</button>
    </div>

    <script>
        async function sendQuery() {
            const input = document.getElementById('queryInput');
            const container = document.getElementById('chat-container');
            const query = input.value;
            if(!query) return;

            // Kullanıcı mesajı
            container.innerHTML += `<div class="message user">${query}</div>`;
            input.value = '';

            // Loading mesajı
            const loadingId = 'loading-' + Date.now();
            container.innerHTML += `<div class="message bot loading" id="${loadingId}">Makaleler indiriliyor ve tüm sayfalar analiz ediliyor... Bu işlem bir dakika sürebilir.</div>`;
            container.scrollTop = container.scrollHeight;

            try {
                const response = await fetch(`/research?query=${encodeURIComponent(query)}`);
                const data = await response.json();

                document.getElementById(loadingId).remove();

                let sourceHtml = '<div class="sources"><b>İncelenen Kaynaklar:</b><br>';
                data.sources.forEach((s, i) => {
                    sourceHtml += `${i+1}. <a href="${s.pdf_url}" target="_blank">${s.title}</a><br>`;
                });
                sourceHtml += '</div>';

                container.innerHTML += `<div class="message bot">${data.analysis}${sourceHtml}</div>`;
            } catch (err) {
                document.getElementById(loadingId).innerText = "Hata oluştu. Lütfen tekrar dene.";
            }
            container.scrollTop = container.scrollHeight;
        }
    </script>
</body>
</html>